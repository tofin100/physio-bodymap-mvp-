<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Physio BodyMap – Muskel-Avatar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-page: #f3f4f6;
      --bg-card: #ffffff;
      --border: #e5e7eb;
      --text: #111827;
      --muted: #6b7280;
      --region-border: #2563eb;
      --region-fill-hover: rgba(96,165,250,0.18);
      --region-fill-selected: rgba(37,99,235,0.38);
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      background:var(--bg-page);
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:1.5rem;
    }
    .card{
      width:100%;
      max-width:1100px;
      background:var(--bg-card);
      border-radius:1rem;
      border:1px solid var(--border);
      box-shadow:0 20px 25px -5px rgba(15,23,42,.06),0 8px 10px -6px rgba(15,23,42,.04);
      padding:1.4rem 1.7rem 1.1rem;
    }
    .card-header{margin-bottom:.9rem;}
    .card-title{font-size:1.25rem;font-weight:600;}
    .card-subtitle{font-size:.9rem;color:var(--muted);margin-top:.15rem;}
    .hint{font-size:.8rem;color:var(--muted);margin-top:.6rem;}
    .bodies{
      display:flex;flex-wrap:wrap;gap:1.25rem;
      justify-content:center;align-items:flex-start;
    }
    .body-panel{
      flex:1;min-width:280px;max-width:380px;
      border-radius:.9rem;border:1px solid var(--border);
      background:#fff;padding:.75rem;
    }
    .body-label{font-size:.8rem;font-weight:500;color:var(--muted);margin-bottom:.25rem;}
    .body-figure{
      position:relative;width:100%;padding-bottom:220%;
      overflow:hidden;border-radius:.75rem;background:#fff;
    }
    .body-img{
      position:absolute;inset:0;width:100%;height:100%;
      object-fit:contain;user-select:none;-webkit-user-drag:none;
      pointer-events:none;
    }
    .body-overlay{position:absolute;inset:0;width:100%;height:100%;}
    .body-overlay svg{width:100%;height:100%;display:block;}
    .region{
      fill:transparent;stroke:transparent;stroke-width:3;
      cursor:pointer;transition:fill .14s ease,stroke .14s ease;
    }
    .region:hover{fill:var(--region-fill-hover);stroke:var(--region-border);}
    .region.selected{fill:var(--region-fill-selected);stroke:var(--region-border);}
    .selected-box{margin-top:1rem;padding-top:.75rem;border-top:1px solid var(--border);}
    .selected-title{font-size:.82rem;font-weight:500;margin-bottom:.35rem;}
    .selected-list{display:flex;flex-wrap:wrap;gap:.35rem;min-height:1.4rem;}
    .selected-pill{
      padding:.16rem .55rem;border-radius:999px;border:1px solid #d1d5db;
      background:#f9fafb;font-size:.76rem;color:var(--muted);
    }
    .selected-empty{font-size:.76rem;color:var(--muted);}
    .actions{margin-top:.65rem;display:flex;justify-content:flex-end;}
    .btn{
      padding:.35rem .9rem;border-radius:999px;border:1px solid var(--border);
      background:#f9fafb;font-size:.75rem;cursor:pointer;color:var(--muted);
    }
    .btn:hover{border-color:#bfdbfe;color:#2563eb;}
    @media(max-width:768px){.card{padding:1.25rem 1.1rem;}}
  </style>
</head>
<body>
  <div class="card">
    <div class="card-header">
      <div class="card-title">Physio BodyMap – Muskel-Avatar</div>
      <div class="card-subtitle">
        Vorder- und Rückansicht mit realistischem Muskelbild. Bereiche können markiert werden, um Beschwerden zu visualisieren.
      </div>
      <p class="hint"><strong>Bedienung:</strong> Bereich anklicken = markieren. Nochmals klicken = Markierung entfernen.</p>
    </div>

    <div class="bodies">
      <!-- Vorderseite -->
      <div class="body-panel">
        <div class="body-label">Vorderseite</div>
        <div class="body-figure">
          <!-- dein Vorderseiten-Bild -->
          <img src="667B025A-1E63-4456-9C9F-D389C044D9CD.png" alt="Muskel Vorderseite" class="body-img" />
          <div class="body-overlay">
            <svg viewBox="0 0 1000 2000">
              <!-- Rough Hotspots – musst du ggf. minimal verschieben, bis sie perfekt sitzen -->
              <ellipse id="front-neck" class="region" cx="500" cy="260" rx="70" ry="60" />
              <path id="front-upper-traps" class="region"
                d="M350 260 Q500 200 650 260 Q630 320 580 340 Q500 320 420 340 Q370 320 350 260 Z" />
              <ellipse id="front-chest-left" class="region" cx="430" cy="360" rx="120" ry="100" />
              <ellipse id="front-chest-right" class="region" cx="570" cy="360" rx="120" ry="100" />
              <ellipse id="front-oblique-left" class="region" cx="380" cy="480" rx="90" ry="120" />
              <ellipse id="front-oblique-right" class="region" cx="620" cy="480" rx="90" ry="120" />
              <rect id="front-upper-abs" class="region" x="440" y="430" width="120" height="120" rx="50" />
              <rect id="front-mid-abs" class="region" x="440" y="540" width="120" height="130" rx="50" />
              <rect id="front-lower-abs" class="region" x="440" y="670" width="120" height="130" rx="50" />
              <ellipse id="front-hip" class="region" cx="500" cy="820" rx="150" ry="90" />
              <ellipse id="front-deltoid-left" class="region" cx="300" cy="360" rx="80" ry="90" />
              <ellipse id="front-deltoid-right" class="region" cx="700" cy="360" rx="80" ry="90" />
              <ellipse id="front-upper-arm-left" class="region" cx="280" cy="520" rx="65" ry="130" />
              <ellipse id="front-upper-arm-right" class="region" cx="720" cy="520" rx="65" ry="130" />
              <ellipse id="front-forearm-left" class="region" cx="260" cy="720" rx="55" ry="140" />
              <ellipse id="front-forearm-right" class="region" cx="740" cy="720" rx="55" ry="140" />
              <ellipse id="front-thigh-left" class="region" cx="430" cy="1050" rx="95" ry="200" />
              <ellipse id="front-thigh-right" class="region" cx="570" cy="1050" rx="95" ry="200" />
              <ellipse id="front-knee-left" class="region" cx="430" cy="1250" rx="70" ry="60" />
              <ellipse id="front-knee-right" class="region" cx="570" cy="1250" rx="70" ry="60" />
              <ellipse id="front-shin-left" class="region" cx="430" cy="1420" rx="70" ry="170" />
              <ellipse id="front-shin-right" class="region" cx="570" cy="1420" rx="70" ry="170" />
              <ellipse id="front-foot-left" class="region" cx="420" cy="1650" rx="80" ry="60" />
              <ellipse id="front-foot-right" class="region" cx="580" cy="1650" rx="80" ry="60" />
            </svg>
          </div>
        </div>
      </div>

      <!-- Rückseite -->
      <div class="body-panel">
        <div class="body-label">Rückseite</div>
        <div class="body-figure">
          <!-- dein Rückseiten-Bild – gleiches File laut deiner Angabe -->
          <img src="667B025A-1E63-4456-9C9F-D389C044D9CD.png" alt="Muskel Rückseite" class="body-img" />
          <div class="body-overlay">
            <svg viewBox="0 0 1000 2000">
              <ellipse id="back-neck" class="region" cx="500" cy="260" rx="70" ry="60" />
              <path id="back-upper-back" class="region"
                d="M340 270 Q500 190 660 270 Q640 340 600 380 Q500 360 400 380 Q360 340 340 270 Z" />
              <ellipse id="back-mid-back" class="region" cx="500" cy="420" rx="170" ry="130" />
              <ellipse id="back-lower-back" class="region" cx="500" cy="560" rx="150" ry="110" />
              <ellipse id="back-glutes" class="region" cx="500" cy="720" rx="170" ry="120" />
              <ellipse id="back-deltoid-left" class="region" cx="300" cy="360" rx="80" ry="90" />
              <ellipse id="back-deltoid-right" class="region" cx="700" cy="360" rx="80" ry="90" />
              <ellipse id="back-upper-arm-left" class="region" cx="280" cy="520" rx="65" ry="130" />
              <ellipse id="back-upper-arm-right" class="region" cx="720" cy="520" rx="65" ry="130" />
              <ellipse id="back-forearm-left" class="region" cx="260" cy="720" rx="55" ry="140" />
              <ellipse id="back-forearm-right" class="region" cx="740" cy="720" rx="55" ry="140" />
              <ellipse id="back-hamstring-left" class="region" cx="430" cy="1050" rx="95" ry="200" />
              <ellipse id="back-hamstring-right" class="region" cx="570" cy="1050" rx="95" ry="200" />
              <ellipse id="back-knee-left" class="region" cx="430" cy="1250" rx="70" ry="60" />
              <ellipse id="back-knee-right" class="region" cx="570" cy="1250" rx="70" ry="60" />
              <ellipse id="back-calf-left" class="region" cx="430" cy="1420" rx="70" ry="170" />
              <ellipse id="back-calf-right" class="region" cx="570" cy="1420" rx="70" ry="170" />
              <ellipse id="back-foot-left" class="region" cx="420" cy="1650" rx="80" ry="60" />
              <ellipse id="back-foot-right" class="region" cx="580" cy="1650" rx="80" ry="60" />
            </svg>
          </div>
        </div>
      </div>
    </div>

    <div class="selected-box">
      <div class="selected-title">Ausgewählte Muskelbereiche</div>
      <div id="selectedList" class="selected-list"></div>
      <div class="actions">
        <button id="clearBtn" class="btn">Auswahl zurücksetzen</button>
      </div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "physio_bodymap_regions_v1";
    const REGION_IDS = [
      "front-neck","front-upper-traps","front-chest-left","front-chest-right",
      "front-oblique-left","front-oblique-right","front-upper-abs","front-mid-abs","front-lower-abs",
      "front-hip","front-deltoid-left","front-deltoid-right","front-upper-arm-left","front-upper-arm-right",
      "front-forearm-left","front-forearm-right","front-thigh-left","front-thigh-right",
      "front-knee-left","front-knee-right","front-shin-left","front-shin-right","front-foot-left","front-foot-right",
      "back-neck","back-upper-back","back-mid-back","back-lower-back","back-glutes",
      "back-deltoid-left","back-deltoid-right","back-upper-arm-left","back-upper-arm-right",
      "back-forearm-left","back-forearm-right","back-hamstring-left","back-hamstring-right",
      "back-knee-left","back-knee-right","back-calf-left","back-calf-right","back-foot-left","back-foot-right"
    ];

    function regionLabel(id){
      const map={
        "front-neck":"Hals vorne",
        "front-upper-traps":"oberer Trapez / Schultergürtel",
        "front-chest-left":"Brust links",
        "front-chest-right":"Brust rechts",
        "front-oblique-left":"seitliche Rumpfmuskeln links",
        "front-oblique-right":"seitliche Rumpfmuskeln rechts",
        "front-upper-abs":"Bauch oben",
        "front-mid-abs":"Bauch Mitte",
        "front-lower-abs":"Bauch unten",
        "front-hip":"Becken / Leiste",
        "front-deltoid-left":"Schulterkappe links",
        "front-deltoid-right":"Schulterkappe rechts",
        "front-upper-arm-left":"Oberarm vorne links",
        "front-upper-arm-right":"Oberarm vorne rechts",
        "front-forearm-left":"Unterarm vorne links",
        "front-forearm-right":"Unterarm vorne rechts",
        "front-thigh-left":"Oberschenkel vorne links",
        "front-thigh-right":"Oberschenkel vorne rechts",
        "front-knee-left":"Knie vorne links",
        "front-knee-right":"Knie vorne rechts",
        "front-shin-left":"Unterschenkel vorne links",
        "front-shin-right":"Unterschenkel vorne rechts",
        "front-foot-left":"Fuß vorne links",
        "front-foot-right":"Fuß vorne rechts",
        "back-neck":"Nacken hinten",
        "back-upper-back":"oberer Rücken",
        "back-mid-back":"mittlerer Rücken",
        "back-lower-back":"unterer Rücken",
        "back-glutes":"Gesäß",
        "back-deltoid-left":"Schulter hinten links",
        "back-deltoid-right":"Schulter hinten rechts",
        "back-upper-arm-left":"Oberarm hinten links",
        "back-upper-arm-right":"Oberarm hinten rechts",
        "back-forearm-left":"Unterarm hinten links",
        "back-forearm-right":"Unterarm hinten rechts",
        "back-hamstring-left":"Oberschenkel hinten links",
        "back-hamstring-right":"Oberschenkel hinten rechts",
        "back-knee-left":"Knie hinten links",
        "back-knee-right":"Knie hinten rechts",
        "back-calf-left":"Wade links",
        "back-calf-right":"Wade rechts",
        "back-foot-left":"Fuß hinten links",
        "back-foot-right":"Fuß hinten rechts"
      };
      return map[id] || id;
    }

    let selectedRegions=[];
    function loadSelections(){
      try{
        const raw=localStorage.getItem(STORAGE_KEY);
        if(!raw)return;
        const parsed=JSON.parse(raw);
        if(Array.isArray(parsed)){
          selectedRegions=parsed.filter(id=>REGION_IDS.includes(id));
        }
      }catch(e){console.error(e);}
    }
    function saveSelections(){
      localStorage.setItem(STORAGE_KEY,JSON.stringify(selectedRegions));
    }

    const selectedListEl=document.getElementById("selectedList");
    const clearBtn=document.getElementById("clearBtn");

    function renderSelectedList(){
      selectedListEl.innerHTML="";
      if(selectedRegions.length===0){
        const span=document.createElement("span");
        span.className="selected-empty";
        span.textContent="Keine Muskelbereiche ausgewählt.";
        selectedListEl.appendChild(span);
        return;
      }
      selectedRegions.forEach(id=>{
        const pill=document.createElement("span");
        pill.className="selected-pill";
        pill.textContent=regionLabel(id);
        selectedListEl.appendChild(pill);
      });
    }

    function applySelectionToSVG(){
      REGION_IDS.forEach(id=>{
        const el=document.getElementById(id);
        if(!el)return;
        if(selectedRegions.includes(id)) el.classList.add("selected");
        else el.classList.remove("selected");
      });
    }

    const changeCallbacks=[];
    function notifyChange(){
      const snapshot=[...selectedRegions];
      changeCallbacks.forEach(fn=>{try{fn(snapshot);}catch(e){console.error(e);}});
    }

    function toggleRegion(id){
      if(selectedRegions.includes(id)){
        selectedRegions=selectedRegions.filter(r=>r!==id);
      }else{
        selectedRegions.push(id);
      }
      applySelectionToSVG();
      renderSelectedList();
      saveSelections();
      notifyChange();
    }

    REGION_IDS.forEach(id=>{
      const el=document.getElementById(id);
      if(!el)return;
      el.addEventListener("click",()=>toggleRegion(id));
    });

    clearBtn.addEventListener("click",()=>{
      selectedRegions=[];
      applySelectionToSVG();
      renderSelectedList();
      saveSelections();
      notifyChange();
    });

    window.PhysioBodyMap={
      getSelections(){return[...selectedRegions];},
      setSelections(ids){
        selectedRegions=(ids||[]).filter(id=>REGION_IDS.includes(id));
        applySelectionToSVG();renderSelectedList();saveSelections();notifyChange();
      },
      clear(){
        selectedRegions=[];applySelectionToSVG();renderSelectedList();saveSelections();notifyChange();
      },
      onChange(cb){if(typeof cb==="function")changeCallbacks.push(cb);},
      getAllRegionIds(){return[...REGION_IDS];}
    };

    loadSelections();
    applySelectionToSVG();
    renderSelectedList();
  </script>
</body>
</html>